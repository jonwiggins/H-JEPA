# Minimal Debug Configuration for M1 Max
# Purpose: Debug and verify fixes for MPS compatibility issues
# Duration: ~30 minutes for quick validation
# Dataset: CIFAR-10 (quick to download and test)

experiment:
  name: debug_minimal_mps
  seed: 42
  output_dir: results/debug_minimal
  save_frequency: 5
  eval_frequency: 5

model:
  encoder_type: vit_base_patch16_224
  embed_dim: 768
  num_hierarchies: 3
  use_rope: false              # Disable RoPE for simplicity
  use_flash_attention: false   # DISABLED - not MPS compatible
  use_gradient_checkpointing: false
  use_layerscale: false        # Disable LayerScale for simplicity
  ema:
    momentum: 0.996
    momentum_end: 1.0
    momentum_warmup_epochs: 1
  predictor:
    depth: 4                   # Reduced depth
    num_heads: 4               # Reduced heads
    mlp_ratio: 2.0             # Reduced MLP ratio
    qkv_bias: true
    dropout: 0.0

data:
  use_multi_dataset: false
  dataset: cifar10
  data_path: ./data
  image_size: 224
  batch_size: 8                # Very small batch for debugging
  num_workers: 2               # Reduced workers
  transforms:
    crop_scale:
      - 0.8
      - 1.0
    horizontal_flip: true
    color_jitter: 0.0          # Disabled for simplicity

training:
  epochs: 3                    # Very short run
  warmup_epochs: 1
  optimizer: adamw
  lr: 0.0005                   # Lower learning rate
  min_lr: 1.0e-6
  weight_decay: 0.04
  betas:
    - 0.9
    - 0.95
  lr_schedule: cosine
  min_lr_ratio: 0.01
  warmup_lr_ratio: 0.001
  use_amp: false               # DISABLED - not MPS compatible

masking:
  num_target_masks: 2          # Reduced masks
  mask_scale:
    - 0.15
    - 0.2
  aspect_ratio:
    - 0.75
    - 1.5
  num_context_masks: 1

loss:
  type: smoothl1
  hierarchy_weights:
    - 1.0
    - 0.7
    - 0.5
  use_vicreg: false            # Disabled to avoid SVD issues

logging:
  experiment_name: debug_minimal_mps
  log_dir: results/debug_minimal/logs
  use_wandb: false             # Disabled for debugging
  use_tensorboard: true        # Keep TensorBoard for monitoring
  log_frequency: 10            # Log every 10 batches
  log_images: false            # Disabled for speed
  log_attention: false         # Disabled for speed
  log_gradients: false         # Disabled for speed
  log_dataset_distribution: false

checkpoint:
  checkpoint_dir: results/debug_minimal/checkpoints
  save_frequency: 1            # Save every epoch
  save_best: true
  metric: val_loss
  mode: min
  keep_last_k: 3

device: mps                    # Apple Silicon
