# H-JEPA Configuration with Rotary Position Embeddings (RoPE)
# This config enables RoPE for improved positional encoding

# Inherit from default config and override specific settings
# Model architecture settings
model:
  # Vision Transformer backbone
  encoder_type: "vit_base_patch16_224"

  # Embedding dimension
  embed_dim: 768

  # Number of hierarchical levels
  num_hierarchies: 3

  # Predictor configuration
  predictor:
    depth: 6
    num_heads: 12
    mlp_ratio: 4.0

  # EMA settings
  ema:
    momentum: 0.996
    momentum_end: 1.0
    momentum_warmup_epochs: 30

  # Rotary Position Embeddings (RoPE) - ENABLED
  rope:
    # Enable RoPE for better position encoding and resolution generalization
    use_rope: true

    # Base frequency for rotation (10000.0 is standard from RoPE paper)
    # This value controls how quickly position information decays
    theta: 10000.0

  # Performance optimizations
  use_flash_attention: true

  # FPN settings
  fpn:
    use_fpn: false
    feature_dim: null
    fusion_method: "add"

# Dataset settings
data:
  dataset: "imagenet"
  data_path: "/path/to/dataset"
  image_size: 224
  batch_size: 128
  num_workers: 8
  pin_memory: true

  augmentation:
    color_jitter: 0.4
    horizontal_flip: true
    random_crop: true

# Masking strategy
masking:
  num_masks: 4
  mask_scale: [0.15, 0.2]
  aspect_ratio: [0.75, 1.5]
  num_context_masks: 1
  context_scale: [0.85, 1.0]

# Training hyperparameters
training:
  epochs: 300
  warmup_epochs: 40
  lr: 1.5e-4
  min_lr: 1.0e-6
  weight_decay: 0.05
  optimizer: "adamw"
  betas: [0.9, 0.95]
  lr_schedule: "cosine"
  clip_grad: 3.0
  use_amp: true
  accumulation_steps: 1
  use_gradient_checkpointing: false

# Loss settings
loss:
  type: "mse"
  hierarchy_weights: [1.0, 0.5, 0.25]
  normalize_embeddings: false

# Checkpointing
checkpoint:
  save_frequency: 10
  keep_best_n: 3
  checkpoint_dir: "results/checkpoints"
  resume: null

# Logging
logging:
  experiment_name: "hjepa_rope"
  log_dir: "results/logs"
  log_frequency: 100

  wandb:
    enabled: true
    project: "h-jepa"
    entity: null
    tags: ["rope", "vit-base", "position-encoding"]

  tensorboard:
    enabled: true

# Distributed training
distributed:
  enabled: false
  backend: "nccl"
  world_size: 1

# Evaluation
evaluation:
  eval_frequency: 10
  linear_probe:
    enabled: false
    dataset: "imagenet"
    batch_size: 256
    epochs: 90
    lr: 0.1

# Reproducibility
seed: 42

# Device
device: "cuda"
